# 仕様草案 > 処理手順 > ブロックパーサ

## 概要

## トークン分割

### ID

- 説明 ... 半角英数, 数字, 一部記号
- 正規表現 ... `[a-zA-Z0-9_-]`

### 記号

- 使用される記号 ... `!` `?` `+` `-` `*` `.` `,` `:` `|` `(` `)` `{` `}` `<`
- 正規表現 ... `[]`

### 処理手順

`BlockParser.source` の長さ分ループして 1 文字ずつ解析する。

文字の種類によって処理を分ける。

#### ID である

一時 ID に文字を追加する。

#### ID でない

一時 ID が空でない ... `ID` トークンを追加して一時 ID をクリアする。

##### `" "` または `"\n"` である

処理後にこの文字をスキップする。

#### `"\""` である

##### 次の `"\""` が見つかる

次の `"\""` までの文字列を元に `String` トークンを追加する。

##### 次の `"\""` が見つからない

#### `"["` である

##### 次の `"]"` が見つかる

次の `"]"` までの文字列を元に `StringInBracket` トークンを追加する。

##### 次の `"]"` が見つかる

`ParseError` の `ExpectedEOF` を送出する。

#### 記号である

`Symbol` トークンを追加する。

## 構文解析

トークンを `*` `TokenKind` `TokenKind:Value` と表記する。

### ブロック

`StringInBracket:*` `Symbol:"{"` `*` `Symbol:"}"` の並びを検出する。

#### Pragma 命令

`Symbol:"+"` `"*"` `Symbol:","`

#### Define 命令

`<ID>` ... `ID:*` (`Symbol:"."` `ID:*`)*

`<ID>` `Symbol:"<"` `Symbol:"-"` `*` `Symbol:","` の並びを検出する。

##### 規則

トークンの長さ分、ループしてトークンを 1 つずつ解析する。

トークンによって処理を分ける。

###### 最後のトークンまたは `Symbol:":"` である

一時 Choice を選択一覧に追加してクリアする。

###### `String` である

一時 Choice の連接に `String` を追加する。

###### `StringInBracket` である

一時 Choice の連接に `CharClass` を追加する。

###### `Symbol:"."` である

一時 Choice の連接に `Wildcard` を追加する。

#### Commentout 命令

`Symbol:"%"` `*` `Symbol:","` の並びを検出する。
