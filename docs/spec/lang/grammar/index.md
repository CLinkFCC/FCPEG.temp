# 構文

## 概要

FCPEG の構文について説明する。

## 基本構文

基本的に改行を自由に行うことはできない。

## 規則構文

### 規則定義

`A <- a`

規則名 A の規則を定義する。

### 選択 (choice)

`e1 : e2 : e3`

`e1` から `e3` を左から順に検査し、いずれかが成功すれば選択が成功する。

1. `e1` が成功したら選択が成功する; 失敗したら `e2` の検査に移る
2. `e2` が成功したら選択が成功する; 失敗したら `e3` の検査に移る
3. `e3` も同様

(例) `"hoge" : "hage"` ... 入力 `hoge` または `hage` で成功する

### 連接 (sequence)

`e1 e2 e3`

`e1` から `e3` を左から順に検査し、順通り成功すれば連接が成功する。

1. `e1` が成功したら `e2` の検査に移る; 失敗したら連接が失敗する
2. `e2` が成功したら `e3` の検査に移る; 失敗したら連接が失敗する
3. `e3` も同様

### 先読み (lookahead)

先読みでは入力を消費しない代わりに、さらに高度な条件指定が可能となる。

#### 肯定的先読み (positive lookahead)

`&a b`

`a` と `b` の両方が成功する場合に肯定的先読みが成功する。
`&a .` もしくは `&. a` と、`&a` は同等である。
`&a &b c` のように先読みを複数繋げることも可能。

1. `a` が **成功** すれば `b` の検査に移る (ただし入力は進めない); 失敗すれば先読みが失敗する
2. `b` が成功すれば先読みが成功する; 失敗すれば先読みが失敗する

(例) `&[a-z0-9] [0-9]` ... 英字 a ~ z を除く数字 0 ~ 9 にマッチ

#### 否定的先読み (negative lookahead)

`!a b`

`a` で失敗し `b` で成功する場合に先読みが成功する。
`!a !b c` のように先読みを複数繋げることも可能。

1. `a` が **失敗** すれば `b` の検査に移る (ただし入力は進めない); 失敗すれば先読みが失敗する
2. `b` が成功すれば先読みが成功する; 失敗すれば先読みが失敗する

(例 1) `![0-9] .` ... 数字 0 ~ 9 を除く任意の 1 文字にマッチ
(例 2) `!("hoge" : "hage") .` ... 数字 0 ~ 9 を除く任意の 1 文字にマッチ

### 繰り返し

#### 数値指定

`{出現回数}` もしくは `{最小回数,最大回数}` の形式で指定する。
後者の場合、`最小回数` を省略すると `0` ( 0 回以上 ) 、`最大回数` を省略すると `-1` ( 最大なし ) が代わりに割り当てられる。

(例 1) `"a"{5}` ... 5 回
入力 `aaaaa` にマッチ

(例 2) `"a"{1,5}` ... 1 回以上 5 回以下
入力 `a` , `aa` , ... , `aaaaa` のいずれかにマッチ

(例 3) `"b"{,5}` ... 0 回以上 5 回以下
入力 `<empty>` , `b` , `bb` , ... , `bbbbb` のいずれかにマッチ

(例 4) `"c"{5,}` ... 5 回以上
入力 `ccccc` , `cccccc` , `ccccccc` , ... のいずれかにマッチ

#### 簡易指定

以下の回数であれば記号 1 つで簡易指定できる。

- 0 または 1 回 ... `?`
  - (例) `e1?` = `e1{,1}`
- 0 回以上 ... `*`
  - (例) `e2*` = `e2{,}`
- 1 回以上 ... `+`
  - (例) `e3+` = `e3{1,}`

### 順不同

### AST 反映 (AST reflection)

> todo: リンク調整

要素の AST への反映方式を指定する。
詳細は [AST 反映](../ast/reflection/index.md) を参照。

#### 反映方式 (reflectable)

`e` ... ノード名未指定
`e#ノード名` ... ノード名指定

`e` を要素ごとのデフォルト名もしくは指定されたノード名で命名し、AST に反映させる。

#### 非反映方式 (unreflectable)

`e#`

`e` を AST に反映しない = ノードとして追加しない

#### 展開方式 (expandable)

`e##`

`e` を変換した先の子ノードを親ノードに展開する。

### 表現 (expression)

以下では表現要素の種別を列挙する。

|      名称      |      英名       |                 内容                 |       例        |
| :------------: | :-------------: | :----------------------------------: | :-------------: |
|   文字クラス   | Character Class | 特定の一文字を正規表現により検査する | `[abc]` `[a-z]` |
|       ID       |       ID        |    自身もしくは他の規則を検査する    |  `Block.Rule`   |
|     文字列     |     String      |     文字列にマッチするか検査する     |    `"hoge"`     |
| ワイルドカード |    Wildcard     |     すべての 1 文字にマッチする      |       `.`       |

## 記述優先度
